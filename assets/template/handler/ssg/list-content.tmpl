{{ define "page" }}
{{ template "layout" . }}
{{ end }}

{{ define "title" }}
Content List
{{ end }}

{{ define "content" }}
<div class="space-y-8">
  <div class="flex justify-between items-center">
    <h1 class="text-2xl font-bold">Content List</h1>
    <div class="w-96">
      <input type="text" 
             id="search-input" 
             name="search" 
             placeholder="Search content by title..." 
             value="{{ .SearchQuery }}"
             class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
             hx-get="/ssg/search-content"
             hx-trigger="keyup changed delay:300ms, search"
             hx-target="#content-table"
             hx-include="#pagination-info">
    </div>
  </div>
  
  <div id="content-table">
    <table class="min-w-full divide-y divide-gray-200">
    <thead class="bg-gray-50">
      <tr>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/4">
          Heading
        </th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/2">
          Body
        </th>
        <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-1/4">
          Actions
        </th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200">
      {{ $csrf := .Form.CSRF }}
      {{ range .Data }}
      <tr>
        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
          <a href="show-content?id={{ .ID }}" class="text-blue-500 hover:underline">{{ .Heading }}</a>
        </td>
        <td class="px-6 py-4 text-sm text-gray-500 w-1/2">
          <div class="truncate w-96">
            {{ Truncate .Body 150 }}
          </div>
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center space-x-2">
          <a href="show-content?id={{ .ID }}" class="inline-block bg-green-500 text-white px-6 py-2 rounded w-24">Show</a>
          <a href="edit-content?id={{ .ID }}" class="inline-block bg-yellow-500 text-white px-6 py-2 rounded w-24">Edit</a>
          <form action="delete-content?id={{ .ID }}" method="POST" class="inline">
            <input type="hidden" name="aquamarine.csrf.token" value="{{ $csrf }}" />
            <button type="submit" class="inline-block bg-red-500 text-white px-6 py-2 rounded w-24">
              Delete
            </button>
          </form>
        </td>
      </tr>
      {{ else }}
      <tr>
        <td colspan="3" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">
          No content found.
        </td>
      </tr>
      {{ end }}
    </tbody>
  </table>
  
  {{ if gt .TotalPages 1 }}
  <div class="flex items-center justify-between bg-white px-4 py-3 sm:px-6 border-t border-gray-200">
    <div class="flex flex-1 justify-between sm:hidden">
      {{ if gt .CurrentPage 1 }}
        <a href="?page={{ Sub .CurrentPage 1 }}{{ if .SearchQuery }}&search={{ .SearchQuery }}{{ end }}" 
           class="relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50">Previous</a>
      {{ end }}
      {{ if lt .CurrentPage .TotalPages }}
        <a href="?page={{ Add .CurrentPage 1 }}{{ if .SearchQuery }}&search={{ .SearchQuery }}{{ end }}"
           class="relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50">Next</a>
      {{ end }}
    </div>
    <div class="hidden sm:flex sm:flex-1 sm:items-center sm:justify-between">
      <div id="pagination-info">
        <p class="text-sm text-gray-700">
          Showing
          <span class="font-medium">{{ Add (Mul (Sub .CurrentPage 1) 25) 1 }}</span>
          to
          <span class="font-medium">{{ Min (Mul .CurrentPage 25) .TotalCount }}</span>
          of
          <span class="font-medium">{{ .TotalCount }}</span>
          results
        </p>
      </div>
      <div>
        <nav class="isolate inline-flex -space-x-px rounded-md shadow-sm" aria-label="Pagination">
          {{ if gt .CurrentPage 1 }}
            <a href="?page={{ Sub .CurrentPage 1 }}{{ if .SearchQuery }}&search={{ .SearchQuery }}{{ end }}" 
               class="relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">
              <span class="sr-only">Previous</span>
              ←
            </a>
          {{ end }}
          
          {{ range $i := .PageNumbers }}
            {{ if eq $i $.CurrentPage }}
              <span class="relative z-10 inline-flex items-center bg-blue-600 px-4 py-2 text-sm font-semibold text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600">{{ $i }}</span>
            {{ else if eq $i -1 }}
              <span class="relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700">...</span>
            {{ else }}
              <a href="?page={{ $i }}{{ if $.SearchQuery }}&search={{ $.SearchQuery }}{{ end }}" 
                 class="relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">{{ $i }}</a>
            {{ end }}
          {{ end }}
          
          {{ if lt .CurrentPage .TotalPages }}
            <a href="?page={{ Add .CurrentPage 1 }}{{ if .SearchQuery }}&search={{ .SearchQuery }}{{ end }}" 
               class="relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">
              <span class="sr-only">Next</span>
              →
            </a>
          {{ end }}
        </nav>
      </div>
    </div>
  </div>
  {{ end }}
  </div>
</div>
{{ end }}

{{ define "submenu" }}
<div class="mx-auto p-4">
  <div class="flex space-x-4 justify-center">
    <a href="{{ newPath "content" }}" class="btn btn-primary">New</a>
  </div>
</div>
{{ end }}
